<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leaderboard • Coding Academy</title>

  {% load static humanize %}

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet" />

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- App CSS -->
  <link rel="stylesheet" href="{% static 'common.css' %}">
  <link rel="stylesheet" href="{% static 'style.css' %}">

  <style>
    :root{
      --bg-0:#0b0c10; --bg-1:#11131a; --bg-2:#0e1016; --line:#1b1f28;
      --text-0:#e7e9ee; --text-1:#9aa3b2; --brand:#00e5ff; --brand-2:#7c4dff; --radius:18px;
    }
    body{ background:var(--bg-0); color:var(--text-0); font-family:'Source Sans 3',system-ui,sans-serif; }
    .navbar{ background:var(--bg-2)!important; border-bottom:1px solid var(--line); }
    .nav-link{ text-transform:uppercase; letter-spacing:.12em; font-size:.78rem; color:var(--text-1)!important; }
    .nav-link.active,.nav-link:hover{ color:var(--text-0)!important; }
    .page-title{ font-family:'Montserrat',system-ui; font-weight:900; }
    .card{ background:var(--bg-1); border:1px solid var(--line); border-radius:var(--radius); }
    .table thead th{ color:var(--text-1); border-bottom-color:var(--line); }
    .table tbody td{ vertical-align:middle; border-color:var(--line); }
    .badge-rank{ background:linear-gradient(90deg,var(--brand),var(--brand-2)); color:#0b0c10; border-radius:999px; font-weight:800; }
    .avatar{ width:36px; height:36px; border-radius:50%; object-fit:cover; border:2px solid var(--line); }
    .muted{ color:var(--text-1); }
    .btn-brand{ background:linear-gradient(90deg,var(--brand),var(--brand-2)); border:none; color:#0b0c10; font-weight:800; }
  </style>
</head>
<body>

  <!-- NAV -->
   <!-- NAV -->
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="/success/">
      <img src="{% static 'logo.svg' %}" alt="Logo" style="width:32px;height:32px" />
    </a>
    <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
      <i class="bi bi-list" style="font-size:1.6rem;color:var(--text-0)"></i>
    </button>
    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ms-3 me-auto align-items-lg-center gap-lg-3">
        <li class="nav-item"><a class="nav-link" href="/success/">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="/tracks/">Tracks</a></li>
        <li class="nav-item"><a class="nav-link" href="/challenges/">Challenges</a></li>
        <li class="nav-item"><a class="nav-link active" href="/leaderboard/">Leaderboard</a></li>
        <li class="nav-item"><a class="nav-link" href="/activity/">Activity</a></li>
      </ul>

      {% if user %}
        <div class="dropdown text-end">
          <a href="#" class="d-inline-flex align-items-center text-decoration-none" data-bs-toggle="dropdown">
            <img src="{{ user.image_url|default:'/static/avatar_placeholder.png' }}" alt="Me" class="avatar" />
            <span class="ms-2 text-white d-none d-md-inline">{{ user.first_name }}</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end shadow">
            <li><a class="dropdown-item" href="/profile/{{ user.id }}/">Profile</a></li>
            <li><a class="dropdown-item" href="/settings/{{ user.id }}/">Settings</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="/logout/">Logout</a></li>
          </ul>
        </div>
      {% else %}
        <a href="/login/" class="btn btn-sm btn-brand">Sign in</a>
      {% endif %}
    </div>
  </div>
</nav>

  <div style="height:72px"></div>

  <!-- HEADER -->
  <section class="py-4">
    <div class="container">
      <div class="d-flex flex-wrap align-items-end justify-content-between gap-3">
        <div>
          <h1 class="page-title mb-1">Leaderboard</h1>
          <div class="muted">Top students by total earnings & progress</div>
        </div>
        <div>
          {% if request.user.is_authenticated %}
            <a href="{% url 'profile' user_id=request.user.id %}" class="btn btn-brand">
              <i class="bi bi-person-check me-1"></i> My Profile
            </a>
          {% else %}
            <a href="/accounts/login/" class="btn btn-brand">
              <i class="bi bi-box-arrow-in-right me-1"></i> Sign in to view your profile
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </section>

  <!-- BOARDS -->
  <section class="pb-5">
    <div class="container">
      <div class="row g-4">
        <!-- Top Earners -->
        <div class="col-12 col-lg-6">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title mb-3"><i class="bi bi-cash-coin me-2"></i>Top Earners</h5>
              <div class="table-responsive">
                <table class="table align-middle">
                  <thead>
                    <tr>
                      <th style="width:64px">#</th>
                      <th>Student</th>
                      <th class="text-end">Earnings</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for u in top_earners %}
                      <tr>
                        <td><span class="badge badge-rank px-3 py-2">{{ forloop.counter }}</span></td>
                        <td>
                          <div class="d-flex align-items-center gap-2">
                            {% with avatar=u.image_url|default:'/static/avatar_placeholder.png' %}
                              <img src="{{ avatar }}" class="avatar" alt="" />
                            {% endwith %}
                            <div>
                              {% if u.id %}
                                <a class="text-decoration-none" href="{% url 'profile' user_id=u.id %}">
                                  {% if u.full_name %}{{ u.full_name }}
                                  {% elif u.get_full_name %}{{ u.get_full_name }}
                                  {% elif u.first_name or u.last_name %}{{ u.first_name }} {{ u.last_name }}
                                  {% elif u.email %}{{ u.email }}
                                  {% else %}User {{ u.id }}{% endif %}
                                </a>
                              {% else %}
                                <span class="text-decoration-none">
                                  {% if u.full_name %}{{ u.full_name }}
                                  {% elif u.get_full_name %}{{ u.get_full_name }}
                                  {% elif u.first_name or u.last_name %}{{ u.first_name }} {{ u.last_name }}
                                  {% elif u.email %}{{ u.email }}
                                  {% else %}User{% endif %}
                                </span>
                              {% endif %}
                              {% if u.email %}<div class="muted small">{{ u.email }}</div>{% endif %}
                            </div>
                          </div>
                        </td>
                        <td class="text-end">
                          {% if u.wallet %}${{ u.wallet.total_earnings|default_if_none:0|floatformat:2 }}{% else %}$0.00{% endif %}
                        </td>
                      </tr>
                    {% empty %}
                      <tr><td colspan="3" class="muted">No data yet.</td></tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Most Points -->
        <div class="col-12 col-lg-6">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title mb-3"><i class="bi bi-trophy me-2"></i>Most Points</h5>
              <div class="table-responsive">
                <table class="table align-middle">
                  <thead>
                    <tr>
                      <th style="width:64px">#</th>
                      <th>Student</th>
                      <th class="text-end">Points</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for s in most_points %}
                      <tr>
                        <td><span class="badge badge-rank px-3 py-2">{{ forloop.counter }}</span></td>
                        <td>
                          <div class="d-flex align-items-center gap-2">
                            {% with avatar=s.user.image_url|default:'/static/avatar_placeholder.png' %}
                              <img src="{{ avatar }}" class="avatar" alt="" />
                            {% endwith %}
                            <div>
                              <a class="text-decoration-none" href="{% url 'profile' user_id=s.user.id %}">
                                {% if s.user.full_name %}{{ s.user.full_name }}
                                {% elif s.user.get_full_name %}{{ s.user.get_full_name }}
                                {% elif s.user.first_name or s.user.last_name %}{{ s.user.first_name }} {{ s.user.last_name }}
                                {% elif s.user.email %}{{ s.user.email }}
                                {% else %}User {{ s.user.id }}{% endif %}
                              </a>
                              {% if s.user.email %}<div class="muted small">{{ s.user.email }}</div>{% endif %}
                            </div>
                          </div>
                        </td>
                        <td class="text-end">{{ s.total_points|default:0|intcomma }}</td>
                      </tr>
                    {% empty %}
                      <tr><td colspan="3" class="muted">No data yet.</td></tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              <div class="mt-3 muted small">
                * Points = completed sections, challenges, and bonuses. Earnings reflect wallet payouts.
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- CTA -->
      <div class="text-center mt-5">
        <a href="/tracks" class="btn btn-brand px-4 py-2">
          <i class="bi bi-rocket-takeoff me-1"></i> Explore Tracks
        </a>
      </div>
    </div>
  </section>

  <footer class="py-4 border-top" style="border-color:var(--line)!important">
    <div class="container d-flex justify-content-between flex-wrap gap-2">
      <div class="d-flex align-items-center gap-2">
        <img src="{% static 'logo.svg' %}" alt="Logo" style="width:20px;height:20px" />
        <span class="muted">© {{ now|date:"Y" }} Coding Academy</span>
      </div>
      <div class="muted"><i class="bi bi-lightning-charge"></i> Learn fast. Ship faster.</div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>